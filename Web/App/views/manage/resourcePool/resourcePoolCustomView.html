<div data-ng-controller="resourcePoolCustomViewController as vm">
    <h2>{{ vm.resourcePool.Name }}</h2>
    <p>
        <div class="btn-group">
            <button type="submit" data-ng-click="vm.increaseMultiplier()" class="btn btn-default">Increase {{ vm.resourcePool.MainElement.MultiplierFieldName }}</button>
            <button type="submit" data-ng-click="vm.decreaseMultiplier()" class="btn btn-default">Decrease {{ vm.resourcePool.MainElement.MultiplierFieldName }}</button>
            <button type="submit" data-ng-click="vm.resetMultiplier()" class="btn btn-default">Reset {{ vm.resourcePool.MainElement.MultiplierFieldName }}</button>
        </div>
    </p>
    <p>
        CMRP Rate: {{ vm.resourcePool.ResourcePoolRatePercentage | percentage:2 }} - Number of ratings: {{ vm.resourcePool.UserResourcePoolRatingCount }}
    </p>
    <table class="table-hover table cmrp">
        <thead>
        <tr>
            <!-- Fields -->
            <th data-ng-repeat="field in vm.resourcePool.MainElement.ElementFieldSet">
                <table class="table cmrp">
                    <tr>
                        <th>
                            {{ field.Name }}
                            <!-- Indexes -->
                            <table class="table cmrp" data-ng-repeat="index in field.ElementFieldIndexSet">
                                <tr>
                                    <th colspan="3">
                                        {{ index.Name }}
                                    </th>
                                </tr>
                                <tr>
                                    <th>
                                        Rat. Avg. Mult.
                                    </th>
                                    <th>
                                        Rat. %
                                    </th>
                                    <th>
                                        Income
                                    </th>
                                </tr>
                            </table>
                        </th>
                        <!-- ResourcePool -->
                        <!-- TODO Single container for these fields? -->
                        <th data-ng-if="field.ElementFieldType === 11">
                            CMRP Add.
                        </th>
                        <th data-ng-if="field.ElementFieldType === 11">
                            {{ field.Name }} incl. CMRP Add.
                        </th>
                        <!-- Multiplier -->
                        <!-- TODO Single container for these fields? -->
                        <th data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                            Total {{ vm.resourcePool.MainElement.ResourcePoolFieldName }}
                        </th>
                        <th data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                            Total CMRP Add.
                        </th>
                        <th data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                            Total {{ vm.resourcePool.MainElement.ResourcePoolFieldName }} incl. CMRP Add.
                        </th>
                    </tr>
                </table>
            </th>
            <!-- Totals -->
            <th>
                Total Income
            </th>
        </tr>
        </thead>
        <tbody>
            <tr data-ng-repeat="elementItem in vm.resourcePool.MainElement.ElementItemSet">
                <!-- Cells -->
                <td data-ng-repeat="elementCell in elementItem.ElementCellSet">
                    <table class="table cmrp">
                        <tr>
                            <td>
                                <span data-ng-if="elementCell.ElementFieldType === 1">
                                    {{ elementCell.StringValue }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 2">
                                    {{ elementCell.BooleanValue }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 3">
                                    {{ elementCell.IntegerValue }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 4">
                                    {{ elementCell.DecimalValue | number: 2 }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 5">
                                    {{ elementCell.DateTimeValue }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 6">
                                    <!-- Element value ? -->
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 11">
                                    {{ elementItem.ResourcePoolValue | number: 2 }}
                                </span>
                                <span data-ng-if="elementCell.ElementFieldType === 12">
                                    {{ elementItem.MultiplierValue | number: 2 }}
                                </span>
                                <!-- Indexes -->
                                <table class="table cmrp" data-ng-repeat="index in elementCell.ElementField.ElementFieldIndexSet">
                                    <tr>
                                        <td>
                                            {{ elementCell.ValueMultiplied | number:2 }}
                                        </td>
                                        <td>
                                            {{ elementCell.ValuePercentage | percentage:2 }}
                                        </td>
                                        <td>
                                            {{ elementCell.ElementFieldIndexIncome | number:2 }}
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <!-- ResourcePool -->
                            <!-- TODO Single container for these fields? -->
                            <td data-ng-if="elementCell.ElementFieldType === 11">
                                {{ elementItem.ResourcePoolAddition | number: 2 }}
                            </td>
                            <td data-ng-if="elementCell.ElementFieldType === 11">
                                {{ elementItem.ResourcePoolValueIncludingAddition | number: 2 }}
                            </td>
                            <!-- Multiplier -->
                            <!-- TODO Single container for these fields? -->
                            <td data-ng-if="elementCell.ElementFieldType === 12 && elementItem.HasResourcePoolCell">
                                {{ elementItem.TotalResourcePoolValue | number: 2 }}
                            </td>
                            <td data-ng-if="elementCell.ElementFieldType === 12 && elementItem.HasResourcePoolCell">
                                {{ elementItem.TotalResourcePoolAddition | number: 2 }}
                            </td>
                            <td data-ng-if="elementCell.ElementFieldType === 12 && elementItem.HasResourcePoolCell">
                                {{ elementItem.TotalResourcePoolValueIncludingAddition | number: 2 }}
                            </td>
                        </tr>
                    </table>
                </td>
                <!-- Totals -->
                <td>
                    {{ elementItem.TotalIncome | number:2 }}
                </td>
            </tr>
        </tbody>
        <tfoot>
            <tr>
                <!-- Fields -->
                <td data-ng-repeat="field in vm.resourcePool.MainElement.ElementFieldSet">
                    <table class="table cmrp">
                        <tr>
                            <td>
                                <!-- TODO Grand Total? -->
                                <span data-ng-if="field.ElementFieldType === 11">
                                    {{ vm.resourcePool.MainElement.ResourcePoolValue | number: 2 }}
                                </span>
                                <span data-ng-if="field.ElementFieldType === 12">
                                    {{ vm.resourcePool.MainElement.MultiplierValue | number: 2 }}
                                </span>
                                <!-- Indexes -->
                                <table class="table cmrp" data-ng-repeat="index in field.ElementFieldIndexSet">
                                    <tr>
                                        <td>
                                            {{ index.ValueMultiplied | number:2 }}
                                        </td>
                                        <td>
                                            {{ index.ValuePercentage | percentage:2 }}
                                        </td>
                                        <td>
                                            {{ index.ElementFieldIndexIncome | number:2 }}
                                        </td>
                                    </tr>
                                </table>
                            </td>
                            <!-- ResourcePool -->
                            <!-- TODO Single container for these fields? -->
                            <td data-ng-if="field.ElementFieldType === 11">
                                {{ vm.resourcePool.MainElement.ResourcePoolAddition | number: 2 }}
                            </td>
                            <td data-ng-if="field.ElementFieldType === 11">
                                {{ vm.resourcePool.MainElement.ResourcePoolValueIncludingAddition | number: 2 }}
                            </td>
                            <!-- Multiplier -->
                            <!-- TODO Single container for these fields? -->
                            <td data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                                {{ vm.resourcePool.MainElement.TotalResourcePoolValue | number: 2 }}
                            </td>
                            <td data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                                {{ vm.resourcePool.MainElement.TotalResourcePoolAddition | number: 2 }}
                            </td>
                            <td data-ng-if="field.ElementFieldType === 12 && vm.resourcePool.MainElement.HasResourcePoolField">
                                {{ vm.resourcePool.MainElement.TotalResourcePoolValueIncludingAddition | number: 2 }}
                            </td>
                        </tr>
                    </table>
                </td>
                <!-- Totals -->
                <td>
                    {{ vm.resourcePool.MainElement.TotalIncome | number: 2 }}
                </td>
            </tr>
        </tfoot>
    </table>
</div>
