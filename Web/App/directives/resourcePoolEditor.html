<div class="resourcePoolEditor">
    <div class="panel panel-default">
        <div class="panel-heading">
            <p data-ng-if="errorMessage.length > 0">
                <span class="label label-warning">{{ errorMessage }}</span>
            </p>
            <h3 class="panel-title">{{ resourcePool.Name }}</h3>
            <div class="resourcePoolFilter">
                <small>
                    <a href="" data-ng-click="resourcePool.currentElement.toggleValueFilter()">{{ resourcePool.currentElement.valueFilterText() }}</a>
                </small>
            </div>
        </div>
        <div class="panel-body">
            <div class="row">
                <div class="col-md-12">

                    <ol class="breadcrumb" data-ng-if="resourcePool.ElementSet.length > 1">
                        <li data-ng-repeat="parent in resourcePool.currentElement.parents()" data-ng-class="{ active: $last }">
                            <a href="#" data-ng-if="!$last" data-ng-click="changeCurrentElement(parent)">
                                {{ parent.Name }}
                            </a>
                            <span data-ng-if="$last">
                                {{ parent.Name }}
                            </span>
                        </li>
                    </ol>
                </div>
                <div data-ng-class="{ 'col-md-4': !resourcePool.currentElement.fullSize(), 'col-md-12': resourcePool.currentElement.fullSize() }">
                    <highchart data-config="chartConfig"></highchart>
                </div>
                <div data-ng-class="{ 'col-md-8': !resourcePool.currentElement.fullSize(), 'col-md-12': resourcePool.currentElement.fullSize() }">
                    <table class="resourcePoolTable table-striped" border="0">
                        <thead>
                            <tr data-ng-if="resourcePool.currentElement.resourcePoolField() !== null && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                <th>
                                    CMRP Rate
                                </th>
                                <td colspan="2">
                                    <span class="fixedWidth45Cell">
                                        {{ resourcePool.resourcePoolRatePercentage() | percentage: 2 }}
                                    </span>
                                    <div data-ng-if="resourcePool.EnableResourcePoolAddition" class="btn-group" role="group">
                                        <button title="Increase CMRP Rate" type="button" data-ng-click="increaseResourcePoolRate()" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">+</button>
                                        <button title="Decrease CMRP Rate" type="button" data-ng-click="decreaseResourcePoolRate()" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">-</button>
                                        <button title="Reset CMRP Rate" type="button" data-ng-click="resetResourcePoolRate()" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">0</button>
                                    </div>
                                </td>
                            </tr>
                            <tr data-ng-if="resourcePool.currentElement.resourcePoolField() !== null && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                <th>
                                    CMRP Amount
                                </th>
                                <td>
                                    {{ resourcePool.currentElement.totalResourcePoolAmount() | number: 2 }}
                                </td>
                            </tr>
                            <tr>
                                <!-- Fields -->
                                <th data-ng-repeat="field in resourcePool.currentElement.ElementFieldSet | orderBy: 'SortOrder'">
                                    <span data-ng-if="field.ElementFieldType !== 6">
                                        {{ field.Name }}
                                    </span>
                                    <span data-ng-if="field.ElementFieldType === 6">
                                        <a href="" data-ng-click="changeCurrentElement(field.SelectedElement)">{{ field.Name }}</a>
                                    </span>
                                </th>
                                <!-- ResourcePool -->
                                <th data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    CMRP Rate<br />
                                    {{ resourcePool.resourcePoolRatePercentage() | percentage: 2 }}
                                </th>
                                <th data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ field.Name }}<br />
                                    incl. CMRP
                                </th>
                                <th data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    Tot. CMRP
                                </th>
                                <th data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    Tot. {{ resourcePool.currentElement.resourcePoolField().Name }}
                                    <br />incl. CMRP
                                </th>
                                <!-- DirectIncome -->
                                <th data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.resourcePoolField().Name }} Income
                                </th>
                                <!-- CMRP Income & Details -->
                                <th data-ng-if="displayIndexDetails" data-ng-repeat="index in resourcePool.currentElement.elementFieldIndexSet()">
                                    {{ index.Name }} Income
                                    <!--- {{ index.ElementField.Element.ResourcePool.MainElement.indexRating() }}
                                    - {{ index.indexRating() }}
                                    - {{ index.indexRatingPercentage() }}
                                    - {{ index.indexIncome() }}
                                    - {{ index.ratingMultiplied() }}
                                    - {{ index.passiveRatingPercentage() }}
                                    - {{ index.referenceRatingMultiplied() }}
                                    - {{ index.aggressiveRating() }}-->
                                </th>
                                <th data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    <!-- Display 'Indexes' view link only if there are more than one index -->
                                    <a href="" data-ng-if="resourcePool.currentElement.elementFieldIndexSet().length > 1" data-ng-click="toggleIndexDetails()">CMRP Income</a>
                                    <!-- If there is only one index, then use that index's name -->
                                    <span data-ng-if="resourcePool.currentElement.elementFieldIndexSet().length === 1">{{ resourcePool.currentElement.elementFieldIndexSet()[0].Name }} Income</span>
                                </th>
                                <!-- Total Income -->
                                <th data-ng-if="resourcePool.currentElement.resourcePoolField()">
                                    Total Income
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr data-ng-repeat="elementItem in resourcePool.currentElement.ElementItemSet">
                                <!-- Cells -->
                                <td data-ng-repeat="elementCell in elementItem.ElementCellSet | orderBy: 'ElementField.SortOrder'">
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 1" data-ng-bind-html="elementCell.StringValue">
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 2">
                                        {{ elementCell.BooleanValue }}
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 3">
                                        {{ elementCell.IntegerValue }}
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 4 && elementCell.ElementField.UseFixedValue">
                                        {{ elementCell.DecimalValue | number: 2 }}
                                    </span>
                                    <div data-ng-if="elementCell.ElementField.ElementFieldType === 4 && !elementCell.ElementField.UseFixedValue">
                                        <span class="fixedWidth35Cell">
                                            {{ elementCell.rating() | number: 2 }}
                                        </span>
                                        <div class="btn-group" role="group" data-ng-if="elementCell.ElementField.ElementFieldIndexSet.length > 0">
                                            <button title="Increase" type="button" data-ng-click="increaseCellIndexRating(elementCell)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">+</button>
                                            <button title="Decrease" type="button" data-ng-click="decreaseCellIndexRating(elementCell)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">-</button>
                                            <button title="Reset" type="button" data-ng-click="resetCellIndexRating(elementCell)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs hide">0</button>
                                        </div>
                                    </div>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 5">
                                        {{ elementCell.DateTimeValue }}
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 6">
                                        {{ elementCell.SelectedElementItem.Name }}
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 11">
                                        {{ elementItem.directIncome() | number: 2 }}
                                    </span>
                                    <span data-ng-if="elementCell.ElementField.ElementFieldType === 12">
                                        {{ elementItem.multiplier() | number: 2 }}
                                    </span>
                                </td>
                                <!-- ResourcePool -->
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.resourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.directIncomeIncludingResourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.totalResourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.totalDirectIncomeIncludingResourcePoolAmount() | number: 2 }}
                                </td>
                                <!-- DirectIncome -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.totalDirectIncome() | number: 2 }}
                                </td>
                                <!-- CMRP Income & Details -->
                                <td data-ng-if="displayIndexDetails" data-ng-repeat="cellIndex in elementItem.elementCellIndexSet2()">
                                    {{ cellIndex.indexIncome() | number: 2 }}
                                    <!--- {{ cellIndex.SelectedElementItem.indexIncome() }}
                                    - {{ cellIndex.SelectedElementItem.ParentCellSet.length }}
                                    - AR: {{ cellIndex.aggressiveRating() }}
                                    - ARP: {{ cellIndex.aggressiveRatingPercentage() }}
                                    - PRP: {{ cellIndex.passiveRatingPercentage() }}-->
                                    <!--{{ cellIndex.ElementItem.Name }}-->
                                </td>
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ elementItem.totalResourcePoolIncome() | number: 2 }}
                                </td>
                                <!-- Total Income -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField()" data-ng-class="{ 'incomeStatusLow': elementItem.incomeStatus() === 'low', 'incomeStatusHigh': elementItem.incomeStatus() === 'high' }">
                                    {{ elementItem.totalIncome() | number: 2 }}
                                </td>
                            </tr>
                        </tbody>
                        <tfoot>
                            <tr data-ng-if="resourcePool.EnableSubtotals">
                                <!-- Fields -->
                                <td data-ng-repeat="field in resourcePool.currentElement.ElementFieldSet | orderBy: 'SortOrder'">
                                    <span data-ng-if="field.ElementFieldType === 11">
                                        {{ resourcePool.currentElement.directIncome() | number: 2 }}
                                    </span>
                                    <span data-ng-if="field.ElementFieldType === 12">
                                        {{ resourcePool.currentElement.multiplier() | number: 2 }}
                                    </span>
                                </td>
                                <!-- ResourcePool -->
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.resourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.directIncomeIncludingResourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.totalResourcePoolAmount() | number: 2 }}
                                </td>
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.totalDirectIncomeIncludingResourcePoolAmount() | number: 2 }}
                                </td>
                                <!-- DirectIncome -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.totalDirectIncome() | number: 2 }}
                                </td>
                                <!-- CMRP Income & Details -->
                                <td data-ng-if="displayIndexDetails" data-ng-repeat="index in resourcePool.currentElement.elementFieldIndexSet()">
                                    {{ index.indexIncome() | number: 2 }}
                                </td>
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    {{ resourcePool.currentElement.totalResourcePoolIncome() | number: 2 }}
                                </td>
                                <!-- Total Income -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField()">
                                    {{ resourcePool.currentElement.totalIncome() | number: 2 }}
                                </td>
                            </tr>
                            <!-- Multiplier functions -->
                            <tr>
                                <!-- Fields -->
                                <td data-ng-repeat="field in resourcePool.currentElement.ElementFieldSet | orderBy: 'SortOrder'">
                                    <div data-ng-if="field.ElementFieldType !== 12">
                                        &nbsp;
                                    </div>
                                    <div data-ng-if="field.ElementFieldType === 12">
                                        <div class="btn-group" role="group">
                                            <button title="Increase {{ resourcePool.currentElement.multiplierField().Name }}" type="button" data-ng-click="increaseElementMultiplier(resourcePool.currentElement)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">+</button>
                                            <button title="Decrease {{ resourcePool.currentElement.multiplierField().Name }}" type="button" data-ng-click="decreaseElementMultiplier(resourcePool.currentElement)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">-</button>
                                            <button title="Reset {{ resourcePool.currentElement.multiplierField().Name }}" type="button" data-ng-click="resetElementMultiplier(resourcePool.currentElement)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">0</button>
                                        </div>
                                    </div>
                                </td>
                                <!-- ResourcePool (Obsolete?) -->
                                <td data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    <div class="btn-group" role="group">
                                        <button title="Increase CMRP Rate" type="button" data-ng-click="increaseResourcePoolRate()" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">+</button>
                                        <button title="Decrease CMRP Rate" type="button" data-ng-click="decreaseResourcePoolRate()" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">-</button>
                                    </div>
                                </td>
                                <td colspan="3" data-ng-if="false && resourcePool.EnableResourcePoolAddition && resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    &nbsp;
                                </td>
                                <!-- DirectIncome -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    &nbsp;
                                </td>
                                <!-- CMRP Income & Details -->
                                <td data-ng-if="displayIndexDetails && resourcePool.currentElement.elementFieldIndexSet().length > 1" data-ng-repeat="index in resourcePool.currentElement.elementFieldIndexSet()">
                                    <div class="btn-group" role="group">
                                        <button title="Increase {{ index.Name }}" type="button" data-ng-click="increaseIndexRating(index)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">+</button>
                                        <button title="Decrease {{ index.Name }}" type="button" data-ng-click="decreaseIndexRating(index)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">-</button>
                                        <button title="Reset {{ index.Name }}" type="button" data-ng-click="resetIndexRating(index)" data-ng-disabled="!isAuthenticated" class="btn btn-default btn-xs">0</button>
                                    </div>
                                </td>
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField() && resourcePool.currentElement.elementFieldIndexSet().length > 0">
                                    &nbsp;
                                </td>
                                <!-- Total Income -->
                                <td data-ng-if="resourcePool.currentElement.resourcePoolField()">
                                    &nbsp;
                                </td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
